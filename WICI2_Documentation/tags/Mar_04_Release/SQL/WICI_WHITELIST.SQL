--Script for CTCOFSMB-1182 Begin
--Table to store WICI device whitelists--

CREATE TABLE WEBIC_OWNER.WICI_WHITELIST 
  (
    AUTHFIELD_VALUE VARCHAR2(200) NOT NULL, 
    AUTHORIZED INTEGER,
    DATE_ADDED TIMESTAMP(6),
    DATE_UPDATED TIMESTAMP(6),
      CONSTRAINT WICI_WHITELIST_PK PRIMARY KEY (AUTHFIELD_VALUE)  
  );

GRANT SELECT, INSERT, UPDATE, DELETE ON WEBIC_OWNER.WICI_WHITELIST TO WEBIC_MAINT;

CREATE SYNONYM WEBIC_APP.WICI_WHITELIST FOR WEBIC_OWNER.WICI_WHITELIST;

 
--Trigger to automatically insert and update the date added and updated on WEBIC_OWNER.WICI_WHITELIST--
CREATE OR REPLACE TRIGGER WEBIC_OWNER.TRG_WICI_WHITELIST
BEFORE INSERT OR UPDATE
ON WEBIC_OWNER.WICI_WHITELIST
REFERENCING OLD AS OLD NEW AS NEW 
FOR EACH ROW 
BEGIN
IF INSERTING THEN
   :NEW.DATE_ADDED := SYSTIMESTAMP;   
ELSE 
   :NEW.DATE_ADDED := :OLD.DATE_ADDED;
   :NEW.DATE_UPDATED := SYSTIMESTAMP;
END IF;
END;
/


--Script for CTCOFSMB-1183 Begin (ENABLE THE AUTHFIELD CHECKING)
INSERT INTO WEBIC_OWNER.WICI_CONFIG (CONFIG_NAME, CONFIG_VALUE) VALUES ('AUTHFIELD_CHECK_ENABLED', 'TRUE');

--Script for CTCOFSMB-1183 End

--Script to Update the APPROVED_APK_VERSION to 691
update WEBIC_OWNER.WICI_CONFIG wc set wc.config_value='1.1.0.1.691' where wc.config_name='APPROVED_APK_VERSION';
commit;